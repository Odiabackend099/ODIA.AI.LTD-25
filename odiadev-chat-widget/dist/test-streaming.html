<!DOCTYPE html>
<html>
<head>
    <title>Streaming Test</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div id="test-results">
        <h1>Streaming Functionality Test</h1>
        <div id="results"></div>
        <button id="run-test">Run Test</button>
    </div>

    <script>
        async function runTest() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Running tests...</p>';
            
            try {
                // Test 1: Check if required APIs are available
                resultsDiv.innerHTML += '<h2>1. Checking API availability...</h2>';
                
                const hasSpeechRecognition = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
                resultsDiv.innerHTML += `<p>Speech Recognition: ${hasSpeechRecognition ? 'OK' : 'MISSING'}</p>`;
                
                const hasAudioContext = 'AudioContext' in window || 'webkitAudioContext' in window;
                resultsDiv.innerHTML += `<p>Audio Context: ${hasAudioContext ? 'OK' : 'MISSING'}</p>`;
                
                const hasMediaDevices = navigator && navigator.mediaDevices && typeof navigator.mediaDevices.getUserMedia === 'function';
                resultsDiv.innerHTML += `<p>Media Devices: ${hasMediaDevices ? 'OK' : 'MISSING'}</p>`;
                
                // Test 2: Check fetch API for streaming
                resultsDiv.innerHTML += '<h2>2. Checking streaming capabilities...</h2>';
                
                const canStream = typeof ReadableStream !== 'undefined' && typeof TextDecoder !== 'undefined';
                resultsDiv.innerHTML += `<p>Streaming Support: ${canStream ? 'OK' : 'MISSING'}</p>`;
                
                // Test 3: Check AbortController support
                resultsDiv.innerHTML += '<h2>3. Checking interruption capabilities...</h2>';
                
                const hasAbortController = typeof AbortController !== 'undefined';
                resultsDiv.innerHTML += `<p>AbortController: ${hasAbortController ? 'OK' : 'MISSING'}</p>`;
                
                // Test 4: Check audio handling
                resultsDiv.innerHTML += '<h2>4. Checking audio handling...</h2>';
                
                const hasAudioAPI = typeof Audio !== 'undefined';
                resultsDiv.innerHTML += `<p>Audio API: ${hasAudioAPI ? 'OK' : 'MISSING'}</p>`;
                
                // Test 5: Overall functionality check
                resultsDiv.innerHTML += '<h2>5. Overall functionality check...</h2>';
                
                const allRequiredFeatures = hasSpeechRecognition && hasAudioContext && hasMediaDevices && 
                                          canStream && hasAbortController && hasAudioAPI;
                
                resultsDiv.innerHTML += `<p>All Required Features: ${allRequiredFeatures ? 'OK' : 'MISSING'}</p>`;
                
                // Final result
                resultsDiv.innerHTML += '<h2>--- TEST RESULTS ---</h2>';
                if (allRequiredFeatures) {
                    resultsDiv.innerHTML += '<p style="color: green; font-weight: bold;">✅ All streaming, voice, and interruption features are supported!</p>';
                    resultsDiv.innerHTML += '<p style="color: green; font-weight: bold;">✅ Ready for ultra-low latency streaming implementation</p>';
                    resultsDiv.innerHTML += '<p style="color: green; font-weight: bold;">true</p>';
                    return true;
                } else {
                    resultsDiv.innerHTML += '<p style="color: red; font-weight: bold;">❌ Some features are missing. Check the detailed output above.</p>';
                    resultsDiv.innerHTML += '<p style="color: red; font-weight: bold;">false</p>';
                    return false;
                }
                
            } catch (error) {
                resultsDiv.innerHTML += `<p style="color: red;">❌ Test failed with error: ${error.message}</p>`;
                resultsDiv.innerHTML += '<p style="color: red; font-weight: bold;">false</p>';
                return false;
            }
        }

        // Add event listener to run test
        document.getElementById('run-test').addEventListener('click', runTest);
        
        // Run test automatically when page loads
        window.addEventListener('load', runTest);
    </script>
</body>
</html>